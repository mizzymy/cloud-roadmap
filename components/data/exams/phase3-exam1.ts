
import { ExamDefinition } from './types';

export const PHASE_3_EXAM_1: ExamDefinition = {
    id: 'sap-c02-exam-1',
    title: 'AWS Solutions Architect Professional - Exam 1 (Real Practice)',
    code: 'SAP-C02',
    description: 'Professional-level difficulty. Complex scenarios covering Multi-Region Architectures, Hybrid Connectivity, Organizations Governance, and Migrations.',
    timeLimitMinutes: 75,
    passingScore: 750,
    totalQuestions: 20,
    questions: [
        {
            id: 'q1',
            scenario: 'Global financial services company. Mission-critical app across us-east-1 and eu-west-1. RPO near-zero, RTO < 10 mins. "Write Local, Read Local" where possible but maintain global consistency. Which database strategy?',
            options: ['RDS PostgreSQL with Cross-Region Read Replicas (Promote manually).', 'Aurora Global Database Multi-Master (Both regions).', 'Aurora Global Database with Write Forwarding and Route 53 ARC.', 'DynamoDB Global Tables.'],
            correctAnswer: 2,
            explanation: 'Aurora Global Database provides <1s replication latency. Write forwarding allows secondary regions to write without app logic changes. Route 53 ARC manages the complex failover readiness for <10 min RTO.',
            distractorExplanation: 'RDS promotion is manual/slow (Standard RTO > 10m). Multi-Master is single region only. DynamoDB is NoSQL (App needs transactional SQL).',
        },
        {
            id: 'q2',
            scenario: '500+ accounts in AWS Organizations. Security team requires no member account can disable CloudTrail. High-cost services (SageMaker P5) only allowed in 2 regions. Least operational overhead?',
            options: ['IAM Permission Boundary on every user.', 'SCP at Root to Deny CloudTrail changes and restrict Regions.', 'CloudFormation StackSets to deploy monitoring Lambda.', 'Config Rules to auto-remediate.'],
            correctAnswer: 1,
            explanation: 'SCPs are the only "Preventative" guardrail that applies to Root users in member accounts. Deny logic is absolute.',
            distractorExplanation: 'Boundaries don\'t apply to Root. Config/StackSets are reactive (remediate after creation).',
        },
        {
            id: 'q3',
            scenario: 'Connecting on-prem to 4 Regions via 10Gbps Direct Connect. Transit Gateways in each region. Simplify routing and minimize BGP sessions. Scalable architecture?',
            options: ['DXGW -> Private VIF -> TGW.', 'DXGW -> TGW (Primary) -> TGW Peering.', 'DXGW -> Transit VIF -> TGWs (in each region).', 'Transit VIF -> TGW -> CloudHub.'],
            correctAnswer: 2,
            explanation: 'Direct Connect Gateway (DXGW) associated with Transit Gateways via a Transit VIF allows a single BGP session to route to multiple regions.',
            distractorExplanation: 'Private VIF determines VGW association, not TGW. TGW Peering adds hop/latency.',
        },
        {
            id: 'q4',
            scenario: 'Hybrid DNS. On-prem servers need to resolve AWS names. EC2 needs to resolve `db.internal.corp` (On-prem). Resilient and no manual IP management.',
            options: ['Bind DNS cluster on EC2 + VPN sync.', 'Route 53 Resolver (Inbound/Outbound Endpoints).', 'Enable DNS Hostnames + DHCP Options set.', 'Route 53 Private Hosted Zones + Manual Records.'],
            correctAnswer: 1,
            explanation: 'Route 53 Resolver Endpoints (Inbound for On-prem->AWS, Outbound for AWS->On-prem) is the managed, high-availability solution.',
            distractorExplanation: 'Bind is unmanaged/high overhead. DHCP options pointing to on-prem breaks AWS internal resolution.',
        },
        {
            id: 'q5',
            scenario: 'Migrate 15 TB Oracle DB to Aurora PostgreSQL. Downtime < 4 hours. Complex schema/triggers.',
            options: ['SCT (Schema) + DMS (Full Load + CDC).', 'Oracle Data Pump -> RDS Oracle -> Cross-Region Replication.', 'Snowball Edge -> RDS Import.', 'GoldenGate.'],
            correctAnswer: 0,
            explanation: 'SCT handles heterogeneous schema conversion. DMS CDC ensures source/target stay in sync until the cutover, meeting the 4h window.',
            distractorExplanation: 'Data Pump doesn\'t convert to Postgres. Snowball is offline (no CDC). GoldenGate is overkill/expensive.',
        },
        {
            id: 'q6',
            scenario: 'Serverless app processing millions of messages/hr via SQS + Lambda. Downstream legacy API can only handle 500 concurrent requests. Lambda is timing out/throttled.',
            options: ['Increase Lambda Memory/Timeout.', 'Set Lambda Reserved Concurrency to 500 + DLQ.', 'Step Functions with Retry.', 'EventBridge Pipe Rate Limiter.'],
            correctAnswer: 1,
            explanation: 'Reserved Concurrency is the mechanism to throttle Lambda consumption of SQS. It protects the downstream system.',
            distractorExplanation: 'Increasing power doesn\'t fix the downstream limit (might make it worse). Pipes is valid technically but Reserved Concurrency is the native Lambda control.',
        },
        {
            id: 'q7',
            scenario: 'Enterprise spending $5M/month on EC2, Fargate, Lambda. High variability in dev, stable prod. Want max discount + flexibility (change instance families/regions).',
            options: ['Standard RIs.', 'Convertible RIs.', 'Compute Savings Plan.', 'EC2 Instance Savings Plans.'],
            correctAnswer: 2,
            explanation: 'Compute Savings Plans apply to EC2, Fargate, and Lambda and allow family/region changes.',
            distractorExplanation: 'Standard RIs are rigid. Convertible only EC2. Instance SPs are family-specific.',
        },
        {
            id: 'q8',
            scenario: 'Monitor accounts for unauthorized access. Aggregate findings from multiple regions. Auto-block malicious IPs at WAF.',
            options: ['Shield Adv + WAF + Logs.', 'GuardDuty + Security Hub + EventBridge -> Lambda.', 'Config + Inspector + SSM.', 'VPC Flow Logs + Macie.'],
            correctAnswer: 1,
            explanation: 'GuardDuty detects threats. Security Hub aggregates. EventBridge triggers Lambda to update WAF IP sets.',
            distractorExplanation: 'Shield is DDoS. Config is compliance.',
        },
        {
            id: 'q9',
            scenario: '100 PB video logs in S3 Standard. Frequent 30d, Rare 60d, Compliance 7yr. Reduce costs drastically but ensure "minutes" retrieval during 60d window.',
            options: ['Standard-IA (30d) -> Glacier Flexible (90d).', 'Intelligent-Tiering.', 'One Zone-IA (30d) -> Deep Archive (90d).', 'Standard-IA (30d) -> Deep Archive (90d).'],
            correctAnswer: 3,
            explanation: 'Standard-IA provides millisecond access (meeting the 60d requirement). Deep Archive is cheapest for 7yr.',
            distractorExplanation: 'Glacier Flexible is usually minutes-hours but Deep Archive is the cost winner for 7yr. One Zone risks data durability.',
        },
        {
            id: 'q10',
            scenario: 'Regulated company. Every EBS volume must be encrypted. If non-compliant volume is found, terminate it automatically.',
            options: ['SCP Deny unencrypted.', 'Enable Default Encryption.', 'Config Rule + SSM Automation (Terminate).', 'IAM Policy.'],
            correctAnswer: 2,
            explanation: 'Config monitors. SSM Automation performs the remediation (Termination).',
            distractorExplanation: 'SCP prevents creation but doesn\'t terminate existing/non-compliant created via other means if logic fails.',
        },
        {
            id: 'q11',
            scenario: 'Microservices "Fan-out". Order service notifies 20 dynamic subscriber services. Reliability critical.',
            options: ['SNS -> HTTP.', 'SNS -> SQS queues (one per service).', 'Kinesis Data Streams.', 'Lambda iterator.'],
            correctAnswer: 1,
            explanation: 'SNS to SQS is the durable fan-out pattern. SQS buffers messages if subscriber is offline.',
            distractorExplanation: 'SNS->HTTP retries are limited. Kinesis is for streaming.',
        },
        {
            id: 'q12',
            scenario: '10 Gbps Direct Connect. Need HA encrypted backup connection. Throughput > 800 Mbps. Cost effective.',
            options: ['VPN over DX (Primary) + VPN over Internet (Backup).', 'Transit VIF + MACsec.', 'DX (Primary) + Client VPN.', 'Private VIF + GRE.'],
            correctAnswer: 0,
            explanation: 'VPN over Public Internet offers a cheap, high-bandwidth (capable of >1Gbps with acceleration) backup to DX.',
            distractorExplanation: 'Second DX is expensive.',
        },
        {
            id: 'q13',
            scenario: 'Migrate 100 TB HDFS (Hadoop) to AWS EMR. Fast as possible. Keep synchronized until validation.',
            options: ['Snowball Edge.', 'AWS DataSync.', 'Transfer Family.', 'S3 DistCp.'],
            correctAnswer: 1,
            explanation: 'DataSync has a specific HDFS connector and synchronization capability.',
            distractorExplanation: 'Snowball is offline.',
        },
        {
            id: 'q14',
            scenario: 'Centralized logging for 200 accounts. Aggregate VPC Flow Logs to single S3 bucket in Security Account. Query with SQL.',
            options: ['Member Account Flow Logs -> Central Bucket ARN. Query Athena.', 'CloudWatch Logs -> Subscription -> Firehose -> S3.', 'Firewall Manager.', 'StackSets Lambda copier.'],
            correctAnswer: 0,
            explanation: 'Flow Logs support direct cross-account delivery to S3.',
            distractorExplanation: 'CloudWatch->Firehose is expensive/complex.',
        },
        {
            id: 'q15',
            scenario: 'Web app 504 Timeouts. RDS MySQL CPU 100% due to Read Spikes. Least impact to app code?',
            options: ['Migrate to DynamoDB.', 'Enable Multi-AZ.', 'ElastiCache (Refactor).', 'Read Replicas + RDS Proxy (or split traffic).'],
            correctAnswer: 3,
            explanation: 'Read Replicas solve read scaling. RDS Proxy handles connections/failover usage without major code rewrite.',
            distractorExplanation: 'DynamoDB/ElastiCache require major rewrite.',
        },
        {
            id: 'q16',
            scenario: 'Serverless API (Gateway + Lambda) accessed by partner with static IP. Restrict access to ONLY that IP.',
            options: ['Lambda logic.', 'API Gateway Resource Policy.', 'WAF.', 'Private Endpoint + Peering.'],
            correctAnswer: 1,
            explanation: 'Resource Policy is the native, free, simple way to whitelist IPs on API Gateway.',
            distractorExplanation: 'WAF costs extra. Lambda logic pays for invocation.',
        },
        {
            id: 'q17',
            scenario: 'CloudFormation stack updates must not accidental delete critical resources (DBs).',
            options: ['Stack Policy Deny `Update:Delete`.', 'DeletionPolicy Retain.', 'Termination Protection.', 'Drift Detection.'],
            correctAnswer: 0,
            explanation: 'Stack Policies control what actions can be performed during an update.',
            distractorExplanation: 'TerminationProtection protects the *Stack*, not resources during update.',
        },
        {
            id: 'q18',
            scenario: 'Audit 50 accounts against PCI-DSS. Dashboard view.',
            options: ['Artifact.', 'Audit Manager.', 'Security Hub.', 'Inspector.'],
            correctAnswer: 2,
            explanation: 'Security Hub Standards (PCI-DSS) provide the dashboard.',
            distractorExplanation: 'Audit Manager collects evidence.',
        },
        {
            id: 'q19',
            scenario: 'Inspect all inter-VPC and outbound traffic. Scalable. Fleet of 3rd party firewalls.',
            options: ['TGW Connect.', 'Gateway Load Balancer (GWLB) + TGW Appliance Mode.', 'VPC Peering.', 'NAT Gateway.'],
            correctAnswer: 1,
            explanation: 'GWLB simplifies appliance insertion. TGW Appliance Mode ensures symmetric routing.',
            distractorExplanation: 'TGW Connect is for SD-WAN.',
        },
        {
            id: 'q20',
            scenario: 'Aurora MySQL patch. Zero Downtime required.',
            options: ['Automatic patching.', 'Manual failover.', 'ZDP.', 'RDS Blue/Green Deployment.'],
            correctAnswer: 3,
            explanation: 'Blue/Green Deployments provide the safest, near-zero downtime mechanism for major changes/patching.',
            distractorExplanation: 'Failover causes 30s outage.',
        }
    ]
};
