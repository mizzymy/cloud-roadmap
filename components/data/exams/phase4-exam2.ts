
import { ExamDefinition } from './types';

export const PHASE_4_EXAM_2: ExamDefinition = {
    id: 'scs-c02-exam-2',
    title: 'AWS Security Specialty - Exam 2 (Real Practice)',
    code: 'SCS-C02',
    description: 'Specialty-level deep dives. Troubleshooting Access, Advanced Networking (TGW/Firewall), Identity Center, and Logging Forensics.',
    timeLimitMinutes: 60,
    passingScore: 750,
    totalQuestions: 20,
    questions: [
        {
            id: 'q1',
            scenario: 'Cross-account S3 Access Denied. User in Account A tries to download KMS-encrypted object in Account B. Bucket Policy allows access. User has `s3:GetObject`.',
            options: ['S3 ACLs not updated.', 'KMS Key Policy in B must trust User A.', 'User A needs `kms:GenerateDataKey`.', 'Bucket Policy needs `kms:Decrypt`.'],
            correctAnswer: 1,
            explanation: 'For KMS-encrypted cross-account access, the Key Policy acts as a second firewall. It must explicitly grant access to the external principal.',
            distractorExplanation: 'ACLs are outdated. `GenerateDataKey` is for upload. Bucket Policies cannot grant KMS permissions.',
        },
        {
            id: 'q2',
            scenario: 'Transit Gateway Inspection. "East-West" traffic must go through Firewall in Security VPC. Ensure symmetric routing.',
            options: ['Enable "Appliance Mode Support" on TGW Attachment.', 'Disable Route Propagation.', 'NLB.', 'Peering.'],
            correctAnswer: 0,
            explanation: 'Appliance Mode ensures traffic flows to the same AZ/ENI for stateful inspection, preventing drops due to asymmetric routing.',
            distractorExplanation: 'Route propagation is standard. NLB doesn\'t fix the TGW asymmetric return path issue.',
        },
        {
            id: 'q3',
            scenario: 'Identity Center ABAC. Allow developers access to EC2 only if "Project" tags match.',
            options: ['Identity Store "Project" attribute.', 'Permission Set with `aws:PrincipalTag` condition AND Enable Attributes for Access Control.', 'SCP.', 'Manual Roles.'],
            correctAnswer: 1,
            explanation: 'You must both Enable Attributes (mapping Identity Provider attributes to AWS tags) AND use the `aws:PrincipalTag` condition in the Permission Set.',
            distractorExplanation: 'Just setting the attribute in the store doesn\'t enforce it.',
        },
        {
            id: 'q4',
            scenario: 'Cognito "Guest" access to S3 (Read-only). No login required.',
            options: ['Self-registration disabled.', 'Cognito Identity Pool "Allow unauthenticated identities".', 'User Pool "Guest" Group.', 'Hardcoded IAM.'],
            correctAnswer: 1,
            explanation: 'Identity Pools support Unauthenticated identities, which assume a specific "Unauth" IAM role.',
            distractorExplanation: 'User Pools are for authenticated users (username/password).',
        },
        {
            id: 'q5',
            scenario: 'Restrict S3 Bucket to specific VPC. No Internet.',
            options: ['Gateway Endpoint + Bucket Policy.', 'S3 Access Point (VPC Origin).', 'NAT Gateway IP Condition.', 'PrivateLink.'],
            correctAnswer: 1,
            explanation: 'S3 Access Points restricted to a VPC origin provide the cleanest, most scalable way to enforce private VPC access.',
            distractorExplanation: 'NAT gateway uses public internet.',
        },
        {
            id: 'q6',
            scenario: 'S3 CORS error. Browser blocks `app.example.com` fetching `assets-example`.',
            options: ['Bucket Policy `Principal: *`.', 'Enable Public Access.', 'CORS Configuration on Bucket.', 'CloudFront OAC.'],
            correctAnswer: 2,
            explanation: 'CORS header validation happens in the browser. The S3 CORS config must allow the Origin.',
            distractorExplanation: 'Bucket policies control AWS Auth, not browser CORS logic.',
        },
        {
            id: 'q7',
            scenario: 'Visualize relationship between API call and EC2 instance (Graph). Root cause analysis.',
            options: ['CloudTrail Insights.', 'GuardDuty.', 'Detective.', 'Security Hub.'],
            correctAnswer: 2,
            explanation: 'Detective builds the Graph visualization of entity relationships.',
            distractorExplanation: 'Insights finds anomalies. GuardDuty alerts.',
        },
        {
            id: 'q8',
            scenario: 'Download SOC 2 Type II report.',
            options: ['Support Center.', 'Public Docs.', 'AWS Artifact.', 'Trusted Advisor.'],
            correctAnswer: 2,
            explanation: 'Artifact is the portal for compliance reports.',
            distractorExplanation: 'Support Center doesn\'t host these docs.',
        },
        {
            id: 'q9',
            scenario: 'Aggregate findings from GuardDuty, Inspector, Access Analyzer across 50 accounts.',
            options: ['Kinesis to S3.', 'Security Hub Delegated Admin.', 'Config Aggregators.', 'CLI script.'],
            correctAnswer: 1,
            explanation: 'Security Hub is the finding aggregator.',
            distractorExplanation: 'Config is for resource state.',
        },
        {
            id: 'q10',
            scenario: 'Patch EC2 instances only on Saturday nights.',
            options: ['State Manager.', 'Patch Manager + Maintenance Windows.', 'Run Command Cron.', 'Config Remediation.'],
            correctAnswer: 1,
            explanation: 'Maintenance Windows provide the scheduling logic for Patch Manager operations.',
            distractorExplanation: 'State Manager applies desired state but Maintenance Windows are for strict time windows.',
        },
        {
            id: 'q11',
            scenario: 'CloudFront private content. Access to multiple files in a directory. Authenticated users.',
            options: ['Signed URLs.', 'Signed Cookies.', 'Pre-signed URLs.', 'OAI.'],
            correctAnswer: 1,
            explanation: 'Signed Cookies allow access to a path pattern (directory) for subsequent requests.',
            distractorExplanation: 'Signed URLs are 1-1 per file (inefficient).',
        },
        {
            id: 'q12',
            scenario: 'Benefit of OAC (Origin Access Control) over OAI.',
            options: ['KMS Support (SSE-KMS).', 'IAM per folder.', 'CORS.', 'Private access.'],
            correctAnswer: 0,
            explanation: 'OAI does not support SSE-KMS encrypted buckets. OAC does.',
            distractorExplanation: 'OAI also provides private access.',
        },
        {
            id: 'q13',
            scenario: 'S3 Upload Fails. User has permission. BPA enabled. Trying to upload with `--acl public-read`.',
            options: ['Explicit Deny ACL.', 'BlockPublicAcls is blocking the request.', 'Public ACLs not supported.', 'ACL priority.'],
            correctAnswer: 1,
            explanation: 'If "Block Public Access" is on, any PUT request including a public ACL is blocked at the API level.',
            distractorExplanation: 'Permissions are fine, the specific "Public ACL" in the request is the trigger.',
        },
        {
            id: 'q14',
            scenario: 'Encryption at rest. Encryption/Decryption must happen ON THE APP SERVER before sending to AWS.',
            options: ['SSE-C.', 'SSE-KMS.', 'Client-Side Encryption (Encryption SDK).', 'SSE-S3.'],
            correctAnswer: 2,
            explanation: 'Client-side encryption happens before the network call.',
            distractorExplanation: 'All SSE options encrypt on the AWS side (Server side).',
        },
        {
            id: 'q15',
            scenario: 'Prevent accidental object deletion. Require MFA for delete.',
            options: ['Object Lock.', 'Compliance Mode.', 'MFA Delete.', 'IAM MFA Condition.'],
            correctAnswer: 2,
            explanation: 'S3 MFA Delete specifically challenges for the DeleteObjectVersion action.',
            distractorExplanation: 'Object lock prevents deletion for a Time, not via Auth challenge.',
        },
        {
            id: 'q16',
            scenario: 'GuardDuty finding NOT appearing in Security Hub. Why?',
            options: ['Different Regions.', 'Severity Low.', 'S3 permissions.', 'User deleted.'],
            correctAnswer: 0,
            explanation: 'Security Hub is regional. It only sees GuardDuty findings from the same region (unless Cross-Region Aggregation is on).',
            distractorExplanation: 'It ingestion all severities.',
        },
        {
            id: 'q17',
            scenario: 'Cognito Identity Pool. Restrict S3 access to `my-bucket/cognito-id/`. Policy variable?',
            options: ['`${cognito-identity.amazonaws.com:sub}`.', '`${aws:username}`.', '`${saml:sub}`.', '`${cognito-idp:sub}`.'],
            correctAnswer: 0,
            explanation: 'This variable represents the unique Identity ID in the pool.',
            distractorExplanation: 'username is for IAM users.',
        },
        {
            id: 'q18',
            scenario: 'Identity Center. Restrict Auditors to Corp IP Address.',
            options: ['Portal URL.', 'Trust Policy.', 'Permission Set Inline Policy (Condition).', 'SCP.'],
            correctAnswer: 2,
            explanation: 'The Permission Set Policy is the correct place to define user-centric session conditions like IP.',
            distractorExplanation: 'SCP is too broad.',
        },
        {
            id: 'q19',
            scenario: 'Rotate S3 KMS Key every 90 days. Ops efficiency.',
            options: ['Manual Create.', 'Enable Automatic Rotation.', 'Lambda.', 'Re-create.'],
            correctAnswer: 1,
            explanation: 'Automatic Rotation is the "set and forget" feature. (Rotates backing key, keeps ARN).',
            distractorExplanation: 'Manual is high overhead.',
        },
        {
            id: 'q20',
            scenario: 'Blast radius of leaked Access Key. Last 7 days. 3 Accounts. Multi-region query.',
            options: ['CloudTrail Lake.', 'Access Analyzer.', 'Config.', 'Flow Logs.'],
            correctAnswer: 0,
            explanation: 'CloudTrail Lake allows SQL queries across organization trails for history.',
            distractorExplanation: 'Access Analyzer finds POLICY risks, not historical activity logs.',
        }
    ]
};
