
import { ExamDefinition } from './types';

export const PHASE_4_EXAM_1: ExamDefinition = {
    id: 'scs-c02-exam-1',
    title: 'AWS Security Specialty - Exam 1 (Real Practice)',
    code: 'SCS-C02',
    description: 'Specialty-level deep dives. Advanced KMS, IAM Policy Logic, Incident Response, and Network Security.',
    timeLimitMinutes: 60,
    passingScore: 750,
    totalQuestions: 20,
    questions: [
        {
            id: 'q1',
            scenario: 'Security Acct (A) owns KMS CMK. Dev Acct (B) needs access. Delegate permission management to Acct-B admins. Least overhead in Acct-A?',
            options: ['Create KMS Grant for every role in B.', 'Update Key Policy in A to trust Root of B (`arn:aws:iam::Acct-B:root`). Manage via IAM in B.', 'Update Key Policy to list all B roles.', 'SCP allows `kms:*`.'],
            correctAnswer: 1,
            explanation: 'Trusting the external account\'s Root user in the Key Policy enables the external account administrators to manage access via local IAM policies.',
            distractorExplanation: 'Grants are for temporary/programmatic access. Listing all roles is high overhead. SCPs cannot grant permissions.',
        },
        {
            id: 'q2',
            scenario: 'Bucket Policy `Effect: Deny`, `Action: s3:DeleteObject`, `NotPrincipal: SecurityAuditRole`. What is the security risk?',
            options: ['Role denied access.', 'Denies everyone effectively (intended).', '`NotPrincipal` + `Deny` is dangerous; allow access to anonymous/cross-account users if not explicitly handled.', 'Policy syntax error.'],
            correctAnswer: 2,
            explanation: '`NotPrincipal` in a Deny statement does NOT deny anonymous users or users from other accounts unless `aws:PrincipalArn` is checked. It is a "blacklist" of internal users only.',
            distractorExplanation: 'Syntax is valid but logic is flawed for "Block Everyone Else".',
        },
        {
            id: 'q3',
            scenario: 'Incident Response. GuardDuty finds EC2 communicating with C&C. Need forensic memory dump. Order of operations?',
            options: ['Stop Instance -> Snapshot.', 'Isolate via SG (Outbound Block) -> Snapshot Memory -> Snapshot Disk.', 'Hibernate -> Snapshot.', 'Reboot to Safe Mode.'],
            correctAnswer: 1,
            explanation: 'Isolation prevents data exfiltration while keeping RAM powered on. Volatility analysis requires live RAM.',
            distractorExplanation: 'Stopping/Hibernating clears RAM.',
        },
        {
            id: 'q4',
            scenario: 'Network Firewall. Block HTTP traffic with specific "Malicious-Header". Allow other HTTP.',
            options: ['Stateless Rule.', 'Stateful Rule Group (Suricata/IPS).', 'Forward to Stateful -> Standard Rule.', 'VPC Lattice.'],
            correctAnswer: 1,
            explanation: 'Stateful rules (Suricata) perform Deep Packet Inspection (DPI) to check L7 headers.',
            distractorExplanation: 'Stateless rules only check L3/L4 (IP/Port).',
        },
        {
            id: 'q5',
            scenario: 'Secrets Manager Rotation for RDS. "Zero Downtime". Forbid use of Root user in Lambda.',
            options: ['Single User Rotation.', 'Alternating Users Rotation (Manager Secret + App User).', 'KMS Key Rotation.', 'Maintenance Window.'],
            correctAnswer: 1,
            explanation: 'Alternating Users strategy allows one user to be rotated while the app uses the other, ensuring zero downtime without using root.',
            distractorExplanation: 'Single User rotation causes a brief connection drop as the password changes.',
        },
        {
            id: 'q6',
            scenario: 'CloudHSM Cluster Initialization. Need to set initial Admin.',
            options: ['SSH to HSM -> Login.', 'Sign CSR -> Upload Cert -> Login as `preco`.', 'Console "Activate".', 'CloudTrail password.'],
            correctAnswer: 1,
            explanation: 'CloudHSM requires a Signed CSR (Customer CA) to establish the root of trust. The `preco` user is used to create the first admin.',
            distractorExplanation: 'No SSH access to HSM appliance. Console doesn\'t manage HSM internal users.',
        },
        {
            id: 'q7',
            scenario: 'WAF Managed Rule Group (SQLi) blocking legitimate "/orders" comments. Fix False Positive securely.',
            options: ['Disable Rule Group.', 'Whitelist "/orders".', 'Override Rule to COUNT + Custom Rule (Block SQLi except on "/orders").', 'Learning Mode.'],
            correctAnswer: 2,
            explanation: 'Overriding to COUNT allows logs but stops blocking. The custom rule applies the block logic everywhere ELSE, or applies a fixed Scope-Down.',
            distractorExplanation: 'Whitelisting opens vulnerability. Disabling removes all protection.',
        },
        {
            id: 'q8',
            scenario: 'Shield Advanced + Route 53. Max DNS resiliency against attacks.',
            options: ['Multi-Value Answer.', 'DNS Firewall.', 'Shuffle Sharding.', 'Geoproximity.'],
            correctAnswer: 2,
            explanation: 'Shuffle Sharding isolates your DNS limits to a specific subset of the Route 53 infrastructure, protecting against "noisy neighbor" or targeted attacks.',
            distractorExplanation: 'DNS Firewall filters queries (outbound). Shuffle Sharding protects the infrastructure.',
        },
        {
            id: 'q9',
            scenario: 'GuardDuty detects malicious IAM user active session. Automate immediate stop.',
            options: ['Delete User.', 'Attach Deny Policy with `aws:TokenIssueTime` condition.', 'SSM Stop Instances.', 'Disable Access Keys.'],
            correctAnswer: 1,
            explanation: 'Only a Policy with `TokenIssueTime` (or revoking all sessions) invalidates the CURRENT temporary credentials/session.',
            distractorExplanation: 'Deleting user doesn\'t kill the active session token.',
        },
        {
            id: 'q10',
            scenario: 'Macie. Search PII across 100 accounts. Central visibility.',
            options: ['Export logs to bucket.', 'Delegated Administrator (Security Account).', 'SCP.', 'Individual Roles.'],
            correctAnswer: 1,
            explanation: 'Macie supports Delegated Admin to view all organization findings in one console.',
            distractorExplanation: 'Logs don\'t provide the dashboard/management interface.',
        },
        {
            id: 'q11',
            scenario: 'Junior Admin can create roles but NOT AdministratorAccess roles. Restrict maximum permissions of created roles.',
            options: ['SCP.', 'IAM Permissions Boundary.', 'Resource Policy.', 'Session Policy.'],
            correctAnswer: 1,
            explanation: 'Permissions Boundaries are the mechanism to restrict the upper bound of permissions a delegated user can grant.',
            distractorExplanation: 'SCP is account-wide.',
        },
        {
            id: 'q12',
            scenario: 'Enforce "Public Access Block" on all new S3 buckets automatically.',
            options: ['CloudWatch Alarm.', 'Bucket Policy Deny.', 'Config Rule + SSM Automation Remediation.', 'Trusted Advisor.'],
            correctAnswer: 2,
            explanation: 'Config "Detects" and SSM "Remediates" (applies the setting).',
            distractorExplanation: 'Bucket Policy Deny prevents removal, but doesn\'t enable it on creation automatically without a pipeline.',
        },
        {
            id: 'q13',
            scenario: 'Ensure no account owner can disable CloudTrail.',
            options: ['Organization Trail (Management Account).', 'SCP Deny StopLogging.', 'Config.', 'Management Account Trail.'],
            correctAnswer: 0,
            explanation: 'Organization Trails are managed only by the Org Master. Member accounts cannot touch them.',
            distractorExplanation: 'SCP is good, but Org Trail is the bulletproof architectural choice.',
        },
        {
            id: 'q14',
            scenario: 'Inspector Agentless Scanning. How?',
            options: ['VPC Flow Logs.', 'EBS Snapshot Analysis.', 'SSM Agent.', 'Banner Grabbing.'],
            correctAnswer: 1,
            explanation: 'Agentless scanning takes snapshots of EBS volumes and scans the file system offline.',
            distractorExplanation: 'SSM Agent is "Agent-based".',
        },
        {
            id: 'q15',
            scenario: 'Private CA. 20 accounts. Centralize to save cost.',
            options: ['RAM Share PCA.', 'Export Key.', 'Cross-Account Role.', 'Not possible.'],
            correctAnswer: 0,
            explanation: 'RAM allows sharing the Private CA resource to other accounts for local issuance.',
            distractorExplanation: 'Exporting CA keys is usually not allowed/secure.',
        },
        {
            id: 'q16',
            scenario: 'VPC Flow Logs show `REJECT` on outbound. SG allows 0.0.0.0/0.',
            options: ['Target SG.', 'NACL (Stateless).', 'Return traffic.', 'IAM.'],
            correctAnswer: 1,
            explanation: 'If SG allows it, the NACL is the only other filter that can REJECT outbound.',
            distractorExplanation: 'SG REJECTs are silent (usually timeout), NACL produces explicit REJECT in logs.',
        },
        {
            id: 'q17',
            scenario: 'Block data scientist from seeing "SSN" column in Athena. S3 data lake.',
            options: ['Bucket Policy.', 'Lake Formation (Column-level).', 'Separate Bucket.', 'Macie Redact.'],
            correctAnswer: 1,
            explanation: 'Lake Formation provides fine-grained column-level access control.',
            distractorExplanation: 'Bucket Policy is object-level.',
        },
        {
            id: 'q18',
            scenario: 'Secrets Manager. Manual rotation for 3rd party site.',
            options: ['Lambda sends SNS notification (Admin manual step).', 'Automatic fail.', 'Not supported.', 'Step Function browser.'],
            correctAnswer: 0,
            explanation: 'Manual rotation is supported by using a Lambda that notifies a human instead of calling an API.',
            distractorExplanation: 'It is supported.',
        },
        {
            id: 'q19',
            scenario: 'Log every keystroke in Session Manager (SSH). Searchable.',
            options: ['CloudTrail Data Events.', 'CloudWatch Logs (Encrypted).', 'S3.', 'Script command.'],
            correctAnswer: 1,
            explanation: 'Session Manager streams session data to CW Logs for indexing/search.',
            distractorExplanation: 'CloudTrail logs API calls (StartSession), not keystrokes.',
        },
        {
            id: 'q20',
            scenario: 'Shield Response Team (SRT) writes custom WAF rules for you.',
            options: ['Root creds.', 'Business/Enterprise Support + Proactive Engagement Role.', 'Automatic access.', 'Config setting.'],
            correctAnswer: 1,
            explanation: 'SRT access requires Business/Enterprise support and explicit permission via a Role.',
            distractorExplanation: 'Root creds never.',
        }
    ]
};
